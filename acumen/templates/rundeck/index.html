{% extends "base.html" %}

{% block content %}
    <div class="ml-64 p-6 bg-gray-100 min-h-screen">
        <h1 class="text-3xl font-bold text-gray-800 mb-6 text-center">Rundeck</h1>

        <!-- Centered Container for Form & Logs -->
        <div class="max-w-5xl mx-auto space-y-6">

            {% if error %}
                <div class="bg-red-100 text-red-700 p-4 rounded-lg mb-6 border border-red-300 relative">
                    <strong>Error:</strong> {{ error }}
                    <button class="absolute top-2 right-3 text-red-700 hover:text-red-900 font-bold"
                            hx-on:click="this.parentElement.remove()">
                        âœ–
                    </button>
                </div>
            {% endif %}

            <!-- Script Execution Form (Wider & Centered) -->
            <div class="bg-white shadow-lg rounded-lg p-6 w-full md:w-2/3 mx-auto">
                <form id="script-form" hx-post="{% url 'stream_script_output' %}" 
                      hx-trigger="submit" hx-target="#script-output" hx-swap="innerHTML">

                    {% csrf_token %}

                    <!-- Script Selector -->
                    <div class="mb-4">
                        <label for="script" class="block text-gray-700 font-semibold mb-2">Select Script:</label>
                        <select name="script" id="script" class="w-full p-3 border rounded-lg bg-gray-100 focus:ring-2 focus:ring-blue-500">
                            {% for script in scripts %}
                                <option value="{{ script.filename }}">{{ script.friendly_name }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Arguments Input -->
                    <div class="mb-4">
                        <label for="arguments" class="block text-gray-700 font-semibold mb-2">Arguments (space-separated):</label>
                        <input 
                            type="text" 
                            name="arguments" 
                            id="arguments" 
                            class="w-full p-3 border rounded-lg bg-gray-100 focus:ring-2 focus:ring-blue-500"
                            placeholder="Enter arguments (e.g., --name David --age 23 --verbose)">
                    </div>

                    <!-- Run Button (Centered & Smaller) -->
                    <div class="flex justify-center">
                        <button type="submit" 
                                class="bg-blue-700 text-white py-3 px-6 rounded-lg font-semibold hover:bg-blue-800 transition duration-200 ease-in-out">
                            Run Script
                        </button>
                    </div>
                </form>
            </div>

            <!-- Live Logs Output (Full Width Below Form) -->
            <div class="bg-white shadow-lg rounded-lg p-6">
                <h2 class="text-lg font-semibold text-gray-800 mb-4">Live Execution Logs</h2>
                <div class="bg-gray-900 text-white p-4 rounded-lg min-h-[300px] max-h-[500px] overflow-y-auto border border-gray-700">
                    <pre id="script-output" class="whitespace-pre-wrap font-mono text-sm"></pre>
                </div>
            </div>

            <!-- Link to Execution Logs -->
            <div class="text-center">
                <a href="{% url 'execution_logs' %}" class="text-blue-600 font-semibold hover:underline">View Execution Logs</a>
            </div>

        </div>
    </div>
{% endblock %}
